#/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/TagBamWithReadSequenceExtended SUMMARY=../dropseq/SRR6814857/unaligned_tagged_Cellular.bam_summary.txt BASE_RANGE=1-12 BASE_QUALITY=10 BARCODED_READ=1 DISCARD_READ=false TAG_NAME=XC NUM_BASES_BELOW_QUALITY=1 INPUT=../cleandata/SRR6814857.unmappedQuerynamesort.bam OUTPUT=../dropseq/tmp/SRR6814857/unaligned_tagged_Cell.bam
#/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/TagBamWithReadSequenceExtended SUMMARY=../dropseq/SRR6814857/unaligned_tagged_Molecular.bam_summary.txt BASE_RANGE=13-20 BASE_QUALITY=10 BARCODED_READ=1 DISCARD_READ=true TAG_NAME=XM NUM_BASES_BELOW_QUALITY=1 INPUT=../dropseq/tmp/SRR6814857/unaligned_tagged_Cell.bam OUTPUT=../dropseq/tmp/SRR6814857/unaligned_tagged_CellMolecular.bam
#/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/FilterBam TAG_REJECT=XQ INPUT=../dropseq/tmp/SRR6814857/unaligned_tagged_CellMolecular.bam OUTPUT=../dropseq/tmp/SRR6814857/unaligned_tagged_filtered.bam
#/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/TrimStartingSequence OUTPUT_SUMMARY=../dropseq/SRR6814857/adapter_trimming_report.txt SEQUENCE=AAGCAGTGGTATCAACGCAGAGTGAATGGG MISMATCHES=0 NUM_BASES=5 INPUT=../dropseq/tmp/SRR6814857/unaligned_tagged_filtered.bam OUTPUT=../dropseq/tmp/SRR6814857/unaligned_tagged_trimmed_smart.bam
#/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/PolyATrimmer OUTPUT=../dropseq/tmp/SRR6814857/unaligned_mc_tagged_polyA_filtered.bam OUTPUT_SUMMARY=../dropseq/SRR6814857/polyA_trimming_report.txt MISMATCHES=0 NUM_BASES=6 NEW=true INPUT=../dropseq/tmp/SRR6814857/unaligned_tagged_trimmed_smart.bam
#java -Xmx500m -jar /lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/3rdParty/picard/picard.jar SamToFastq INPUT=../dropseq/tmp/SRR6814857/unaligned_mc_tagged_polyA_filtered.bam FASTQ=../dropseq/tmp/SRR6814857/unaligned_mc_tagged_polyA_filtered.fastq
STAR --genomeDir /lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq-2.3.0/metadata/mm10/STAR_index --outFileNamePrefix ../dropseq/tmp/SRR6814857/star. --readFilesIn ../dropseq/tmp/SRR6814857/unaligned_mc_tagged_polyA_filtered.fastq --runThreadN 20 &&

java -Dsamjdk.buffer_size=131072 -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10 -Xmx4000m -jar /lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/3rdParty/picard/picard.jar SortSam INPUT=../dropseq/tmp/SRR6814857/star.Aligned.out.sam OUTPUT=../dropseq/tmp/SRR6814857/aligned.sorted.bam SORT_ORDER=queryname TMP_DIR=../dropseq/tmp/SRR6814857 &&

java -Xmx4000m -jar /lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/3rdParty/picard/picard.jar MergeBamAlignment REFERENCE_SEQUENCE=/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq-2.3.0/metadata/mm10/mm10.fasta UNMAPPED_BAM=../dropseq/tmp/SRR6814857/unaligned_mc_tagged_polyA_filtered.bam ALIGNED_BAM=../dropseq/tmp/SRR6814857/aligned.sorted.bam INCLUDE_SECONDARY_ALIGNMENTS=false PAIRED_RUN=false CLIP_ADAPTERS=false TMP_DIR=../dropseq/tmp/SRR6814857 OUTPUT=../dropseq/tmp/SRR6814857/merged.bam &&

/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/TagReadWithInterval I=../dropseq/tmp/SRR6814857/merged.bam O=../dropseq/tmp/SRR6814857/gene_tagged.bam TMP_DIR=../dropseq/tmp/SRR6814857 INTERVALS=/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq-2.3.0/metadata/mm10/mm10.genes.intervals TAG=XG &&

/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/TagReadWithGeneFunction O=../dropseq/tmp/SRR6814857/function_tagged.bam ANNOTATIONS_FILE=/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq-2.3.0/metadata/mm10/mm10.refFlat INPUT=../dropseq/tmp/SRR6814857/gene_tagged.bam &&

/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/DetectBeadSubstitutionErrors INPUT=../dropseq/tmp/SRR6814857/function_tagged.bam OUTPUT=../dropseq/tmp/SRR6814857/substitution_repaired.bam TMP_DIR=../dropseq/tmp/SRR6814857 MIN_UMIS_PER_CELL=20 OUTPUT_REPORT=../dropseq/SRR6814857/substitution_error_report.txt &&

/lustre1/lch3000_pkuhpc/liuyt/software/Drop-seq_tools-2.3.0/DetectBeadSynthesisErrors INPUT=../dropseq/tmp/SRR6814857/substitution_repaired.bam MIN_UMIS_PER_CELL=20 OUTPUT_STATS=../dropseq/SRR6814857/synthesis_error_stats.txt SUMMARY=../dropseq/SRR6814857/synthesis_error_summary.txt REPORT=../dropseq/SRR6814857/synthesis_error_report.txt CREATE_INDEX=true TMP_DIR=../dropseq/tmp/SRR6814857 OUTPUT=../dropseq/SRR6814857/final.bam

